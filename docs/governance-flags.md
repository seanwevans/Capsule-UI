# Governance Flags

Capsule enforces a strict style contract through lint and build checks. Two environment flags act as escape hatches when that contract needs to bend:

## `CAPSULE_LAYER_NAMES`
Use this to override the required `@layer components` name or to supply additional layer names (e.g. `utilities,components`). Real-world scenarios include:

- Integrating a legacy marketing site that ships `@layer legacy` styles compiled outside Capsule.
- Building a shared utilities layer (e.g. `utilities,components`) that must load before component styles.
- Prototyping in a sandbox where the final layer order is still being debated.

**Trade-offs:** Diverging layer names can fragment the contract and make components behave differently across teams. Misordered layers may hide bugs or allow unintended overrides.

**Consistency tips:** document the chosen layer order in an ADR, share configuration across repos, and review custom layer names in code review.

### Example ADR: Temporary legacy layer support

**Context.** The marketing site still relies on `@layer legacy` generated by an older build pipeline.

**Decision.** Set `CAPSULE_LAYER_NAMES="legacy,components"` for the marketing package so legacy styles are applied first.

**Return plan.** Migrate the legacy styles to design tokens by Q4 and remove the environment override to return to the default `@layer components` rule.

## `CAPSULE_ALLOW_RUNTIME_STYLES`
Setting this flag allows runtime CSS-in-JS imports that Capsule normally blocks. Use it only when:

- Styles must react to live data that cannot be expressed with design tokens (e.g. a dashboard colouring cells based on user metrics).
- A third-party library injects styles at runtime and cannot be precompiled.
- Performing a temporary migration away from an existing CSS-in-JS solution.

**Trade-offs:** runtime styling increases bundle size, skips static analysis, and can erode token discipline. Overuse leads to unpredictable styling and harder debugging.

**Consistency tips:** require an ADR for each exception, scope dynamic styles to leaf components, and track these usages for eventual removal.

### Example ADR: Allow dynamic theme experiment

**Context.** An A/B test needs to swap theme colours per user at runtime to measure engagement.

**Decision.** Set `CAPSULE_ALLOW_RUNTIME_STYLES=true` for the `experiment-banner` component so it can inject inline styles.

**Return plan.** Once tokens support the needed theming, remove the runtime styling and unset the flag to restore the default static analysis.

---

Bending Capsule's contract should be rare and deliberate. When these flags are used, capture the rationale, plan a path back to the default, and communicate decisions so teams stay aligned.
